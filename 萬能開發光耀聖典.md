# 萬能開發光耀聖典

## 📜 聖典總綱

本聖典整合 JunAiKey 項目的所有開發智慧，提供完整的開發指導方針和最佳實踐。

## 🎯 核心理念

### 1. 雙語言開發原則
- **堅持使用 TypeScript** 作為主要開發語言
- **繁中英碼終始矩陣**：始終保持繁體中文註釋和英文變量名稱的平衡
- **代碼可讀性**：確保代碼既符合技術規範又具有文化内涵

### 2. AI 模型中立性
- 支持多種 AI 模型提供者（OpenAI、Google Gemini、Anthropic Claude 等）
- 實現模型抽象層，便於動態切換
- 鼓勵模型備份機制確保系統穩定性

### 3. Markdown 開發環境
- 統一的 Markdown 解析和偵錯框架
- 實時預覽和性能監控
- 完整的測試和部署流程

## 📚 開發章節

### 第一章：TypeScript 開發規範

#### 1.1 基本原則
```typescript
// ✅ 正確示範
class JunAiKeySystem {
  private readonly systemName: string;
  private readonly version: string;
  
  constructor(name: string, version: string) {
    this.systemName = name;
    this.version = version;
  }
  
  public getSystemInfo(): SystemInfo {
    return {
      name: this.systemName,
      version: this.version,
      timestamp: new Date()
    };
  }
}
```

#### 1.2 類型定義規範
```typescript
// ✅ 複合型別定義
export interface JunAiKeyConfig {
  readonly systemName: string;
  readonly version: string;
  readonly debugMode: boolean;
  readonly modelProvider: ModelProvider;
}

// ✅ 列舉類型定義
export enum ModelProvider {
  OPENAI = 'openai',
  GEMINI = 'gemini',
  CLAUDE = 'claude',
  CUSTOM = 'custom'
}
```

#### 1.3 錯誤處理規範
```typescript
// ✅ 錯誤處理模式
export class JunAiKeyError extends Error {
  public readonly code: string;
  public readonly statusCode: number;
  public readonly retryable: boolean;
  
  constructor(
    code: string,
    message: string,
    statusCode: number = 500,
    retryable: boolean = false
  ) {
    super(message);
    this.code = code;
    this.statusCode = statusCode;
    this.retryable = retryable;
  }
}
```

### 第二章：AI 模型整合

#### 2.1 模型抽象層
```typescript
// ✅ 模型抽象接口
export interface IAIModel {
  generate(prompt: string): Promise<AIResponse>;
  fineTune(data: TrainingData[]): Promise<void>;
  getModelInfo(): ModelInfo;
}

// ✅ 具體實現
export class OpenAIModel implements IAIModel {
  private readonly apiKey: string;
  private readonly model: string;
  
  constructor(apiKey: string, model: string = 'gpt-4') {
    this.apiKey = apiKey;
    this.model = model;
  }
  
  public async generate(prompt: string): Promise<AIResponse> {
    // OpenAI API 調用實現
  }
}
```

#### 2.2 模型管理器
```typescript
// ✅ 模型管理器
export class ModelManager {
  private models: Map<string, IAIModel> = new Map();
  private defaultModel: string;
  
  public registerModel(name: string, model: IAIModel): void {
    this.models.set(name, model);
  }
  
  public getModel(name: string): IAIModel | null {
    return this.models.get(name) || null;
  }
  
  public switchModel(name: string): boolean {
    if (this.models.has(name)) {
      this.defaultModel = name;
      return true;
    }
    return false;
  }
}
```

### 第三章：Markdown 開發框架

#### 3.1 Markdown 解析引擎
```typescript
// ✅ Markdown 引擎
export class MarkdownEngine {
  private parser: any;
  private debugger: MarkdownDebugger;
  
  constructor(options: MarkdownEngineOptions) {
    this.parser = this.createParser(options);
    this.debugger = new MarkdownDebugger();
  }
  
  public async parse(content: string): Promise<MarkdownDocument> {
    return this.debugger.wrapExecution(
      () => this.parser.parse(content),
      'markdown_parse'
    );
  }
}
```

#### 3.2 偵錯工具組
```typescript
// ✅ 偵錯器
export class MarkdownDebugger {
  private breakpoints: Map<string, DebugBreakpoint[]> = new Map();
  private logger: Logger;
  
  public setBreakpoint(file: string, line: number): void {
    this.breakpoints.set(file, [
      ...(this.breakpoints.get(file) || []),
      { line, enabled: true }
    ]);
  }
  
  public wrapExecution<T>(
    operation: () => Promise<T>,
    operationName: string
  ): Promise<T> {
    return this.logger.wrapAsync(
      operation,
      operationName,
      { enableDebug: true }
    );
  }
}
```

### 第四章：系統架構設計

#### 4.1 核心系統結構
```typescript
// ✅ 系統核心
export class JunAiKeyCore {
  private readonly config: JunAiKeyConfig;
  private readonly modelManager: ModelManager;
  private readonly markdownEngine: MarkdownEngine;
  private readonly errorMonitor: ErrorMonitor;
  
  constructor(config: JunAiKeyConfig) {
    this.config = config;
    this.modelManager = new ModelManager();
    this.markdownEngine = new MarkdownEngine(config.markdownOptions);
    this.errorMonitor = new ErrorMonitor();
  }
  
  public async initialize(): Promise<void> {
    await this.initializeModels();
    await this.initializeMarkdownEngine();
    this.setupErrorHandling();
  }
}
```

#### 4.2 事件系統
```typescript
// ✅ 事件系統
export class EventBus {
  private events: Map<string, EventListener[]> = new Map();
  
  public on(event: string, listener: EventListener): void {
    if (!this.events.has(event)) {
      this.events.set(event, []);
    }
    this.events.get(event)!.push(listener);
  }
  
  public emit(event: string, data: any): void {
    const listeners = this.events.get(event) || [];
    listeners.forEach(listener => listener(data));
  }
}
```

## 🔧 開發工具鏈

### 1. 開發環境配置
```json
{
  "name": "junaikey-dev",
  "version": "1.0.0",
  "scripts": {
    "dev": "ts-node src/index.ts",
    "build": "tsc",
    "test": "jest",
    "lint": "eslint src/**/*.ts",
    "markdown:debug": "node --inspect-brk src/markdown/debugger.js"
  }
}
```

### 2. 依賴包管理
```json
{
  "dependencies": {
    "@modelcontextprotocol/sdk": "^1.19.1",
    "typescript": "^5.3.3",
    "markdown-it": "^13.0.0",
    "unified": "^10.0.0"
  },
  "devDependencies": {
    "@types/node": "^20.19.19",
    "jest": "^30.2.0",
    "ts-jest": "^29.4.4"
  }
}
```

### 3. 配置文件
```typescript
// config/junaikey.config.ts
export const JUNAIKEY_CONFIG = {
  system: {
    name: "JunAiKey",
    version: "1.0.0",
    debug: process.env.NODE_ENV === "development"
  },
  models: {
    default: "openai",
    providers: {
      openai: { apiKey: process.env.OPENAI_API_KEY },
      gemini: { apiKey: process.env.GEMINI_API_KEY }
    }
  },
  markdown: {
    enableDebug: true,
    parserOptions: {
      breaks: true,
      gfm: true
    }
  }
};
```

## 🧪 測試策略

### 1. 單元測試
```typescript
// tests/core/system.test.ts
describe('JunAiKeyCore', () => {
  test('should initialize successfully', async () => {
    const core = new JunAiKeyCore(TEST_CONFIG);
    await expect(core.initialize()).resolves.not.toThrow();
  });
});
```

### 2. 集成測試
```typescript
// tests/integration/model.test.ts
describe('Model Integration', () => {
  test('should switch between models', async () => {
    const manager = new ModelManager();
    manager.registerModel('openai', new OpenAIModel('test'));
    manager.registerModel('gemini', new GeminiModel('test'));
    
    expect(manager.switchModel('gemini')).toBe(true);
    expect(manager.getModel('gemini')).toBeDefined();
  });
});
```

### 3. 端到端測試
```typescript
// tests/e2e/markdown.test.ts
describe('Markdown E2E', () => {
  test('should parse complex markdown', async () => {
    const engine = new MarkdownEngine(TEST_MARKDOWN_CONFIG);
    const result = await engine.parse(COMPLEX_MARKDOWN);
    
    expect(result.type).toBe('document');
    expect(result.children).toHaveLength(5);
  });
});
```

## 📈 性能監控

### 1. 性能指標
```typescript
// src/monitoring
